import{J as Ot,b as kt,c as It,sb as F}from"./chunk-RNY6U3WJ.js";import{a as h}from"./chunk-M2JW2GFW.js";import{d as Tt,f as U}from"./chunk-SXMPUQ6M.js";var st=Tt(z=>{"use strict";h();Object.defineProperty(z,"__esModule",{value:!0});z.removeMarkdown=void 0;var Ct=function(t,e){e===void 0&&(e={listUnicodeChar:""}),e=e||{},e.listUnicodeChar=e.hasOwnProperty("listUnicodeChar")?e.listUnicodeChar:!1,e.stripListLeaders=e.hasOwnProperty("stripListLeaders")?e.stripListLeaders:!0,e.gfm=e.hasOwnProperty("gfm")?e.gfm:!0,e.useImgAltText=e.hasOwnProperty("useImgAltText")?e.useImgAltText:!0,e.preserveLinks=e.hasOwnProperty("preserveLinks")?e.preserveLinks:!1;var r=t||"";r=r.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,"");try{e.stripListLeaders&&(e.listUnicodeChar?r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,e.listUnicodeChar+" $1"):r=r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),e.gfm&&(r=r.replace(/\n={2,}/g,`
`).replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),e.preserveLinks&&(r=r.replace(/\[(.*?)\][\[\(](.*?)[\]\)]/g,"$1 ($2)")),r=r.replace(/<[^>]*>/g,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,e.useImgAltText?"$1":"").replace(/\[(.*?)\][\[\(].*?[\]\)]/g,"$1").replace(/^\s{0,3}>\s?/g,"").replace(/(^|\n)\s{0,3}>\s?/g,`

`).replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/\n{2,}/g,`

`)}catch(o){return console.error(o),t}return r};z.removeMarkdown=Ct});h();h();h();h();h();var rt={rect:"rectangle",circle:"ellipse"},ot={startOnLoad:!1,flowchart:{curve:"linear"},themeVariables:{fontSize:`${20*1.25}px`}};var L=class{constructor({converter:e}){this.convert=(r,o)=>this.converter(r,{...o,fontSize:o.fontSize||20}),this.converter=e}};h();h();var R;(function(t){t.ROUND="round",t.STADIUM="stadium",t.DOUBLECIRCLE="doublecircle",t.CIRCLE="circle",t.DIAMOND="diamond"})(R||(R={}));var V;(function(t){t.COLOR="color"})(V||(V={}));var M;(function(t){t.FILL="fill",t.STROKE="stroke",t.STROKE_WIDTH="stroke-width",t.STROKE_DASHARRAY="stroke-dasharray"})(M||(M={}));var nt=U(st(),1),Nt={arrow_circle:{endArrowhead:"dot"},arrow_cross:{endArrowhead:"bar"},double_arrow_circle:{endArrowhead:"dot",startArrowhead:"dot"},double_arrow_cross:{endArrowhead:"bar",startArrowhead:"bar"},double_arrow_point:{endArrowhead:"arrow",startArrowhead:"arrow"}},at=t=>Nt[t],j=t=>{let e=t.text;return t.labelType==="markdown"&&(e=(0,nt.removeMarkdown)(t.text)),Lt(e)},Lt=t=>{let e=/\s?(fa|fab):[a-zA-Z0-9-]+/g;return t.replace(e,"")},it=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case M.FILL:{e.backgroundColor=t[r],e.fillStyle="solid";break}case M.STROKE:{e.strokeColor=t[r];break}case M.STROKE_WIDTH:{e.strokeWidth=Number(t[r]?.split("px")[0]);break}case M.STROKE_DASHARRAY:{e.strokeStyle="dashed";break}}}),e},ct=t=>{let e={};return Object.keys(t).forEach(r=>{switch(r){case V.COLOR:{e.strokeColor=t[r];break}}}),e};var _t=t=>{let e={};t.subGraphs.map(o=>{o.nodeIds.forEach(n=>{e[o.id]={id:o.id,parent:null,isLeaf:!1},e[n]={id:n,parent:o.id,isLeaf:t.vertices[n]!==void 0}})});let r={};return[...Object.keys(t.vertices),...t.subGraphs.map(o=>o.id)].forEach(o=>{if(!e[o])return;let n=e[o],a=[];for(n.isLeaf||a.push(`subgraph_group_${n.id}`);n.parent;)a.push(`subgraph_group_${n.parent}`),n=e[n.parent];r[o]=a}),{getGroupIds:o=>r[o]||[],getParentId:o=>e[o]?e[o].parent:null}},lt=new L({converter:(t,e)=>{let r=[],o=e.fontSize,{getGroupIds:n,getParentId:a}=_t(t);return t.subGraphs.reverse().forEach(s=>{let i=n(s.id),c={id:s.id,type:"rectangle",groupIds:i,x:s.x,y:s.y,width:s.width,height:s.height,label:{groupIds:i,text:j(s),fontSize:o,verticalAlign:"top"}};r.push(c)}),Object.values(t.vertices).forEach(s=>{if(!s)return;let i=n(s.id),c=it(s.containerStyle),l=ct(s.labelStyle),d={id:s.id,type:"rectangle",groupIds:i,x:s.x,y:s.y,width:s.width,height:s.height,strokeWidth:2,label:{groupIds:i,text:j(s),fontSize:o,...l},link:s.link||null,...c};switch(s.type){case R.STADIUM:{d={...d,roundness:{type:3}};break}case R.ROUND:{d={...d,roundness:{type:3}};break}case R.DOUBLECIRCLE:{i.push(`doublecircle_${s.id}}`);let f={type:"ellipse",groupIds:i,x:s.x+5,y:s.y+5,width:s.width-5*2,height:s.height-5*2,strokeWidth:2,roundness:{type:3},label:{groupIds:i,text:j(s),fontSize:o}};d={...d,groupIds:i,type:"ellipse"},r.push(f);break}case R.CIRCLE:{d.type="ellipse";break}case R.DIAMOND:{d.type="diamond";break}}r.push(d)}),t.edges.forEach(s=>{let i=[],c=a(s.start),l=a(s.end);c&&c===l&&(i=n(c));let{startX:d,startY:p,reflectionPoints:f}=s,m=f.map(u=>[u.x-f[0].x,u.y-f[0].y]),x=at(s.type),E={id:`${s.start}_${s.end}`,type:"arrow",groupIds:i,x:d,y:p,strokeWidth:s.stroke==="thick"?4:2,strokeStyle:s.stroke==="dotted"?"dashed":void 0,points:m,...s.text?{label:{text:j(s),fontSize:o,groupIds:i}}:{},roundness:{type:2},...x},y=r.find(u=>u.id===s.start),w=r.find(u=>u.id===s.end);!y||!w||(E.start={id:y.id||""},E.end={id:w.id||""},r.push(E))}),{elements:r}}});h();h();var O=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");var dt=new L({converter:t=>{let e=O(),{width:r,height:o}=t,n={type:"image",x:0,y:0,width:r,height:o,status:"saved",fileId:e};return{files:{[e]:{id:e,mimeType:t.mimeType,dataURL:t.dataURL}},elements:[n]}}});h();h();var $=t=>{let e={type:"line",x:t.startX,y:t.startY,points:[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t.strokeStyle||"solid",strokeColor:t.strokeColor||"#000",strokeWidth:t.strokeWidth||1};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},G=t=>{let e={type:"text",x:t.x,y:t.y,width:t.width,height:t.height,text:t.text||"",fontSize:t.fontSize,verticalAlign:"middle"};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),t.id&&Object.assign(e,{id:t.id}),e},B=t=>{let e={};t.type==="rectangle"&&t.subtype==="activation"&&(e={backgroundColor:"#e9ecef",fillStyle:"solid"});let r={id:t.id,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,label:{text:t?.label?.text||"",fontSize:t?.label?.fontSize,verticalAlign:t.label?.verticalAlign||"middle",strokeColor:t.label?.color||"#000",groupIds:t.groupId?[t.groupId]:[]},strokeStyle:t?.strokeStyle,strokeWidth:t?.strokeWidth,strokeColor:t?.strokeColor,backgroundColor:t?.bgColor,fillStyle:"solid",...e};return t.groupId&&Object.assign(r,{groupIds:[t.groupId]}),r},W=t=>{let e={type:"arrow",x:t.startX,y:t.startY,points:t.points||[[0,0],[t.endX-t.startX,t.endY-t.startY]],width:t.endX-t.startX,height:t.endY-t.startY,strokeStyle:t?.strokeStyle||"solid",endArrowhead:t?.endArrowhead||null,startArrowhead:t?.startArrowhead||null,label:{text:t?.label?.text||"",fontSize:16},roundness:{type:2},start:t.start,end:t.end};return t.groupId&&Object.assign(e,{groupIds:[t.groupId]}),e};var ut=new L({converter:t=>{let e=[],r=[];if(Object.values(t.nodes).forEach(o=>{!o||!o.length||o.forEach(n=>{let a;switch(n.type){case"line":a=$(n);break;case"rectangle":case"ellipse":a=B(n);break;case"text":a=G(n);break;default:throw`unknown type ${n.type}`}n.type==="rectangle"&&n?.subtype==="activation"?r.push(a):e.push(a)})}),Object.values(t.lines).forEach(o=>{o&&e.push($(o))}),Object.values(t.arrows).forEach(o=>{o&&(e.push(W(o)),o.sequenceNumber&&e.push(B(o.sequenceNumber)))}),e.push(...r),t.loops){let{lines:o,texts:n,nodes:a}=t.loops;o.forEach(s=>{e.push($(s))}),n.forEach(s=>{e.push(G(s))}),a.forEach(s=>{e.push(B(s))})}return t.groups&&t.groups.forEach(o=>{let{actorKeys:n,name:a}=o,s=1/0,i=1/0,c=0,l=0;if(!n.length)return;e.filter(g=>{if(g.id){let T=g.id.indexOf("-"),C=g.id.substring(0,T);return n.includes(C)}}).forEach(g=>{if(g.x===void 0||g.y===void 0||g.width===void 0||g.height===void 0)throw new Error(`Actor attributes missing ${g}`);s=Math.min(s,g.x),i=Math.min(i,g.y),c=Math.max(c,g.x+g.width),l=Math.max(l,g.y+g.height)});let p=10,f=s-p,m=i-p,x=c-s+p*2,b=l-i+p*2,E=O(),y=B({type:"rectangle",x:f,y:m,width:x,height:b,bgColor:o.fill,id:E});e.unshift(y);let w=O(),u=[E];e.forEach(g=>{if(g.type!=="frame"){if(g.x===void 0||g.y===void 0||g.width===void 0||g.height===void 0)throw new Error(`Element attributes missing ${g}`);if(g.x>=s&&g.x+g.width<=c&&g.y>=i&&g.y+g.height<=l){let T=g.id||O();g.id||Object.assign(g,{id:T}),u.push(T)}}});let A={type:"frame",id:w,name:a,children:u};e.push(A)}),{elements:e}}});h();var pt=new L({converter:t=>{let e=[];return Object.values(t.nodes).forEach(r=>{!r||!r.length||r.forEach(o=>{let n;switch(o.type){case"line":n=$(o);break;case"rectangle":case"ellipse":n=B(o);break;case"text":n=G(o);break;default:throw`unknown type ${o.type}`}e.push(n)})}),Object.values(t.lines).forEach(r=>{r&&e.push($(r))}),Object.values(t.arrows).forEach(r=>{if(!r)return;let o=W(r);e.push(o)}),Object.values(t.text).forEach(r=>{let o=G(r);e.push(o)}),Object.values(t.namespaces).forEach(r=>{let o=Object.keys(r.classes),n=[...o],a=[...t.lines,...t.arrows,...t.text];o.forEach(i=>{let c=a.filter(l=>l.metadata&&l.metadata.classId===i).map(l=>l.id);c.length&&n.push(...c)});let s={type:"frame",id:O(),name:r.id,children:n};e.push(s)}),{elements:e}}});var mt=(t,e={})=>{switch(t.type){case"graphImage":return dt.convert(t,e);case"flowchart":return lt.convert(t,e);case"sequence":return ut.convert(t,e);case"class":return pt.convert(t,e);default:throw new Error(`graphToExcalidraw: unknown graph type "${t.type}, only flowcharts are supported!"`)}};h();h();var $e=U(kt(),1),Be=U(It(),1);var Ge=U(Ot(),1);h();var Y=t=>{t=Dt(t);let e=t.replace(/#(\d+);/g,"&#$1;").replace(/#([a-z]+);/g,"&$1;"),r=document.createElement("textarea");return r.innerHTML=e,r.value},P=t=>{let r=t.getAttribute("transform")?.match(/translate\(([ \d.-]+),\s*([\d.-]+)\)/),o=0,n=0;return r&&(o=Number(r[1]),n=Number(r[2])),{transformX:o,transformY:n}},ft=t=>{let e=t;return e=e.replace(/style.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/classDef.*:\S*#.*;/g,r=>r.substring(0,r.length-1)),e=e.replace(/#\w+;/g,r=>{let o=r.substring(1,r.length-1);return/^\+?\d+$/.test(o)?`\uFB02\xB0\xB0${o}\xB6\xDF`:`\uFB02\xB0${o}\xB6\xDF`}),e},Dt=function(t){return t.replace(/ﬂ°°/g,"#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},H=(t,e={x:0,y:0})=>{if(t.tagName.toLowerCase()!=="path")throw new Error(`Invalid input: Expected an HTMLElement of tag "path", got ${t.tagName}`);let r=t.getAttribute("d");if(!r)throw new Error('Path element does not contain a "d" attribute');let o=r.split(/(?=[LM])/),n=o[0].substring(1).split(",").map(i=>parseFloat(i)),a=o[o.length-1].substring(1).split(",").map(i=>parseFloat(i)),s=o.map(i=>{let c=i.substring(1).split(",").map(l=>parseFloat(l));return{x:c[0],y:c[1]}}).filter((i,c,l)=>{if(c===l.length-1)return!0;let d=l[c-1];return c===0||i.x!==d.x&&i.y!==d.y}).map(i=>({x:i.x+e.x,y:i.y+e.y}));return{startX:n[0]+e.x,startY:n[1]+e.y,endX:a[0]+e.x,endY:a[1]+e.y,reflectionPoints:s}};h();var Rt=(t,e)=>{let r=t.nodes.map(i=>i.startsWith("flowchart-")?i.split("-")[1]:i),o=e.querySelector(`[id='${t.id}']`);if(!o)throw new Error("SubGraph element not found");let n=J(o,e),a=o.getBBox(),s={width:a.width,height:a.height};return t.classes=void 0,t.dir=void 0,{...t,nodeIds:r,...n,...s,text:Y(t.title)}},Yt=(t,e)=>{let r=e.querySelector(`[id*="flowchart-${t.id}-"]`);if(!r)return;let o;r.parentElement?.tagName.toLowerCase()==="a"&&(o=r.parentElement.getAttribute("xlink:href"));let n=J(o?r.parentElement:r,e),a=r.getBBox(),s={width:a.width,height:a.height},i=r.querySelector(".label-container")?.getAttribute("style"),c=r.querySelector(".label")?.getAttribute("style"),l={};i?.split(";").forEach(p=>{if(!p)return;let f=p.split(":")[0].trim(),m=p.split(":")[1].trim();l[f]=m});let d={};return c?.split(";").forEach(p=>{if(!p)return;let f=p.split(":")[0].trim(),m=p.split(":")[1].trim();d[f]=m}),{id:t.id,labelType:t.labelType,text:Y(t.text),type:t.type,link:o||void 0,...n,...s,containerStyle:l,labelStyle:d}},Pt=(t,e)=>{let r=e.querySelector(`[id*="L-${t.start}-${t.end}"]`);if(!r)throw new Error("Edge element not found");let o=J(r,e),n=H(r,o);return t.length=void 0,{...t,...n,text:Y(t.text)}},J=(t,e)=>{if(!t)throw new Error("Element not found");let r=t.parentElement?.parentElement,o=t.childNodes[0],n={x:0,y:0};if(o){let{transformX:c,transformY:l}=P(o),d=o.getBBox();n={x:Number(o.getAttribute("x"))||c+d.x||0,y:Number(o.getAttribute("y"))||l+d.y||0}}let{transformX:a,transformY:s}=P(t),i={x:a+n.x,y:s+n.y};for(;r&&r.id!==e.id;){if(r.classList.value==="root"&&r.hasAttribute("transform")){let{transformX:c,transformY:l}=P(r);i.x+=c,i.y+=l}r=r.parentElement}return i},ht=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getVertices();Object.keys(o).forEach(s=>{o[s]=Yt(o[s],e)});let n=r.getEdges().map(s=>Pt(s,e));return{type:"flowchart",subGraphs:r.getSubGraphs().map(s=>Rt(s,e)),vertices:o,edges:n}};h();h();var gt=(t,e)=>{let r={};e?.label&&(r.label={text:Y(e.label),fontSize:16});let o=t.tagName;if(o==="line")r.startX=Number(t.getAttribute("x1")),r.startY=Number(t.getAttribute("y1")),r.endX=Number(t.getAttribute("x2")),r.endY=Number(t.getAttribute("y2"));else if(o==="path"){let n=t.getAttribute("d");if(!n)throw new Error('Path element does not contain a "d" attribute');let a=n.split(/(?=[LC])/),s=a[0].substring(1).split(",").map(l=>parseFloat(l)),i=[];a.forEach(l=>{let d=l.substring(1).trim().split(" ").map(p=>{let[f,m]=p.split(",");return[parseFloat(f)-s[0],parseFloat(m)-s[1]]});i.push(...d)});let c=i[i.length-1];r.startX=s[0],r.startY=s[1],r.endX=c[0],r.endY=c[1],r.points=i}return e?.label&&(r.startY=r.startY-10,r.endY=r.endY-10),r.strokeColor=t.getAttribute("stroke"),r.strokeWidth=Number(t.getAttribute("stroke-width")),r.type="arrow",r.strokeStyle=e?.strokeStyle||"solid",r.startArrowhead=e?.startArrowhead||null,r.endArrowhead=e?.endArrowhead||null,r},tt=(t,e,r,o,n)=>{let a={};return a.type="arrow",a.startX=t,a.startY=e,a.endX=r,a.endY=o,Object.assign(a,{...n}),a},K=(t,e,r,o)=>({type:"text",x:t,y:e,text:r,width:o?.width||20,height:o?.height||20,fontSize:o?.fontSize||20,id:o?.id,groupId:o?.groupId,metadata:o?.metadata}),et=(t,e,r)=>{let o={},n=Number(t.getAttribute("x")),a=Number(t.getAttribute("y"));o.type="text",o.text=Y(e),r?.id&&(o.id=r.id),r?.groupId&&(o.groupId=r.groupId);let s=t.getBBox();o.width=s.width,o.height=s.height,o.x=n-s.width/2,o.y=a;let i=parseInt(getComputedStyle(t).fontSize);return o.fontSize=i,o},N=(t,e,r={})=>{let o={};o.type=e;let{label:n,subtype:a,id:s,groupId:i}=r;o.id=s,i&&(o.groupId=i),n&&(o.label={text:Y(n.text),fontSize:16,verticalAlign:n?.verticalAlign});let c=t.getBBox();switch(o.x=c.x,o.y=c.y,o.width=c.width,o.height=c.height,o.subtype=a,a){case"highlight":let l=t.getAttribute("fill");l&&(o.bgColor=l);break;case"note":o.strokeStyle="dashed";break}return o},q=(t,e,r,o,n,a)=>{let s={};return s.startX=e,s.startY=r,s.endX=o,a?.groupId&&(s.groupId=a.groupId),a?.id&&(s.id=a.id),s.endY=n,s.strokeColor=t.getAttribute("stroke"),s.strokeWidth=Number(t.getAttribute("stroke-width")),s.type="line",s};var bt={0:"SOLID",1:"DOTTED",3:"SOLID_CROSS",4:"DOTTED_CROSS",5:"SOLID_OPEN",6:"DOTTED_OPEN",24:"SOLID_POINT",25:"DOTTED_POINT"},_={SOLID:0,DOTTED:1,NOTE:2,SOLID_CROSS:3,DOTTED_CROSS:4,SOLID_OPEN:5,DOTTED_OPEN:6,LOOP_START:10,LOOP_END:11,ALT_START:12,ALT_ELSE:13,ALT_END:14,OPT_START:15,OPT_END:16,ACTIVE_START:17,ACTIVE_END:18,PAR_START:19,PAR_AND:20,PAR_END:21,RECT_START:22,RECT_END:23,SOLID_POINT:24,DOTTED_POINT:25,AUTONUMBER:26,CRITICAL_START:27,CRITICAL_OPTION:28,CRITICAL_END:29,BREAK_START:30,BREAK_END:31,PAR_OVER_START:32},vt=t=>{let e;switch(t){case _.SOLID:case _.SOLID_CROSS:case _.SOLID_OPEN:case _.SOLID_POINT:e="solid";break;case _.DOTTED:case _.DOTTED_CROSS:case _.DOTTED_OPEN:case _.DOTTED_POINT:e="dotted";break;default:e="solid";break}return e},Xt=(t,e)=>{if(!!t.nextElementSibling?.classList.contains("sequenceNumber")){let o=t.nextElementSibling?.textContent;if(!o)throw new Error("sequence number not present");let n=30,a=n/2,s=10,i={type:"rectangle",x:e.startX-s,y:e.startY-a,label:{text:o,fontSize:14},bgColor:"#e9ecef",height:n,subtype:"sequence"};Object.assign(e,{sequenceNumber:i})}},xt=(t,e,r)=>{if(!t)throw"root node not found";let o=O(),n=Array.from(t.children),a=[];return n.forEach((s,i)=>{let c=`${r?.id}-${i}`,l;switch(s.tagName){case"line":let d=Number(s.getAttribute("x1")),p=Number(s.getAttribute("y1")),f=Number(s.getAttribute("x2")),m=Number(s.getAttribute("y2"));l=q(s,d,p,f,m,{groupId:o,id:c});break;case"text":l=et(s,e,{groupId:o,id:c});break;case"circle":l=N(s,"ellipse",{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c});default:l=N(s,rt[s.tagName],{label:s.textContent?{text:s.textContent}:void 0,groupId:o,id:c})}a.push(l)}),a},Mt=(t,e)=>{let r=Array.from(e.querySelectorAll(".actor-top")),o=Array.from(e.querySelectorAll(".actor-bottom")),n=[],a=[];return Object.values(t).forEach((s,i)=>{let c=r.find(p=>p.getAttribute("name")===s.name),l=o.find(p=>p.getAttribute("name")===s.name);if(!c||!l)throw"root not found";let d=s.description;if(s.type==="participant"){let p=N(c,"rectangle",{id:`${s.name}-top`,label:{text:d},subtype:"actor"});if(!p)throw"Top Node element not found!";n.push([p]);let f=N(l,"rectangle",{id:`${s.name}-bottom`,label:{text:d},subtype:"actor"});n.push([f]);let m=c?.parentElement?.previousElementSibling;if(m?.tagName!=="line")throw"Line not found";let x=Number(m.getAttribute("x1"));if(!p.height)throw"Top node element height is null";let b=p.y+p.height,E=f.y,y=Number(m.getAttribute("x2")),w=q(m,x,b,y,E);a.push(w)}else if(s.type==="actor"){let p=xt(c,d,{id:`${s.name}-top`});n.push(p);let f=xt(l,d,{id:`${s.name}-bottom`});n.push(f);let m=c.previousElementSibling;if(m?.tagName!=="line")throw"Line not found";let x=Number(m.getAttribute("x1")),b=Number(m.getAttribute("y1")),E=Number(m.getAttribute("x2")),y=f.find(w=>w.type==="ellipse");if(y){let w=y.y,u=q(m,x,b,E,w);a.push(u)}}}),{nodes:n,lines:a}},$t=(t,e)=>{let r=[],o=Array.from(e.querySelectorAll('[class*="messageLine"]')),n=Object.keys(bt),a=t.filter(s=>n.includes(s.type.toString()));return o.forEach((s,i)=>{let c=a[i],l=bt[c.type],d=gt(s,{label:c?.message,strokeStyle:vt(c.type),endArrowhead:l==="SOLID_OPEN"||l==="DOTTED_OPEN"?null:"arrow"});Xt(s,d),r.push(d)}),r},Bt=(t,e)=>{let r=Array.from(e.querySelectorAll(".note")).map(a=>a.parentElement),o=t.filter(a=>a.type===_.NOTE),n=[];return r.forEach((a,s)=>{if(!a)return;let i=a.firstChild,c=o[s].message,l=N(i,"rectangle",{label:{text:c},subtype:"note"});n.push(l)}),n},qt=t=>{let e=Array.from(t.querySelectorAll("[class*=activation]")),r=[];return e.forEach(o=>{let n=N(o,"rectangle",{label:{text:""},subtype:"activation"});r.push(n)}),r},Gt=(t,e)=>{let r=Array.from(e.querySelectorAll(".loopLine")),o=[],n=[],a=[];r.forEach(d=>{let p=Number(d.getAttribute("x1")),f=Number(d.getAttribute("y1")),m=Number(d.getAttribute("x2")),x=Number(d.getAttribute("y2")),b=q(d,p,f,m,x);b.strokeStyle="dotted",b.strokeColor="#adb5bd",b.strokeWidth=2,o.push(b)});let s=Array.from(e.querySelectorAll(".loopText")),i=t.filter(d=>d.type===_.CRITICAL_START).map(d=>d.message);s.forEach(d=>{let p=d.textContent||"",f=et(d,p),m=p.match(/\[(.*?)\]/)?.[1]||"";i.includes(m)&&(f.x+=16),n.push(f)});let c=Array.from(e?.querySelectorAll(".labelBox")),l=Array.from(e?.querySelectorAll(".labelText"));return c.forEach((d,p)=>{let f=l[p]?.textContent||"",m=N(d,"rectangle",{label:{text:f}});m.strokeColor="#adb5bd",m.bgColor="#e9ecef",m.width=void 0,a.push(m)}),{lines:o,texts:n,nodes:a}},Ft=t=>{let e=Array.from(t.querySelectorAll(".rect")).filter(o=>o.parentElement?.tagName!=="g"),r=[];return e.forEach(o=>{let n=N(o,"rectangle",{label:{text:""},subtype:"highlight"});r.push(n)}),r},yt=(t,e)=>{t.parse();let r=t.parser.yy,o=[],n=r.getBoxes(),a=Ft(e),s=r.getActors(),{nodes:i,lines:c}=Mt(s,e),l=r.getMessages(),d=$t(l,e),p=Bt(l,e),f=qt(e),m=Gt(l,e);return o.push(a),o.push(...i),o.push(p),o.push(f),{type:"sequence",lines:c,arrows:d,nodes:o,loops:m,groups:n}};h();var Z={AGGREGATION:0,EXTENSION:1,COMPOSITION:2,DEPENDENCY:3,LOLLIPOP:4},Et={LINE:0,DOTTED_LINE:1},v=16,jt=t=>{let e;switch(t){case Et.LINE:e="solid";break;case Et.DOTTED_LINE:e="dotted";break;default:e="solid"}return e},St=t=>{let e;switch(t){case Z.AGGREGATION:e="diamond_outline";break;case Z.COMPOSITION:e="diamond";break;case Z.EXTENSION:e="triangle_outline";break;case"none":e=null;break;case Z.DEPENDENCY:default:e="arrow";break}return e},Ut=(t,e)=>{let r=[],o=[],n=[];return Object.values(t).forEach(a=>{let{domId:s,id:i}=a,c=O(),l=e.querySelector(`[id*=classId-${i}]`);if(!l)throw Error(`DOM Node with id ${s} not found`);let{transformX:d,transformY:p}=P(l),f=N(l.firstChild,"rectangle",{id:i,groupId:c});f.x+=d,f.y+=p,f.metadata={classId:i},r.push(f),Array.from(l.querySelectorAll(".divider")).forEach(b=>{let E=Number(b.getAttribute("x1")),y=Number(b.getAttribute("y1")),w=Number(b.getAttribute("x2")),u=Number(b.getAttribute("y2")),A=q(b,E,y,w,u,{groupId:c,id:O()});A.startX+=d,A.startY+=p,A.endX+=d,A.endY+=p,A.metadata={classId:i},o.push(A)});let x=l.querySelector(".label")?.children;if(!x)throw"label nodes not found";Array.from(x).forEach(b=>{let E=b.textContent;if(!E)return;let y=O(),{transformX:w,transformY:u}=P(b),A=b.getBBox(),g=10,T=K(d+w,p+u+g,E,{width:A.width,height:A.height,id:y,groupId:c,metadata:{classId:i}});n.push(T)})}),{nodes:r,lines:o,text:n}},Vt=(t,e)=>{let r=["triangle_outline","diamond","diamond_outline"],o=e.startArrowhead&&r.includes(e.startArrowhead),n=e.endArrowhead&&r.includes(e.endArrowhead);return!n&&!o||(o&&(t==="LR"?e.startX-=v:t==="RL"?e.startX+=v:t==="TB"?e.startY-=v:t==="BT"&&(e.startY+=v)),n&&(t==="LR"?e.endX+=v:t==="RL"?e.endX-=v:t==="TB"?e.endY+=v:t==="BT"&&(e.endY-=v))),e},zt=(t,e,r,o)=>{let n=r.querySelector(".edgePaths")?.children;if(!n)throw new Error("No Edges found!");let a=[],s=[];return t.forEach((i,c)=>{let{id1:l,id2:d,relation:p}=i,f=e.find(X=>X.id===l),m=e.find(X=>X.id===d),x=jt(p.lineType),b=St(p.type1),E=St(p.type2),y=H(n[c]),w=tt(y.startX,y.startY,y.endX,y.endY,{strokeStyle:x,startArrowhead:b,endArrowhead:E,label:i.title?{text:i.title}:void 0,start:{type:"rectangle",id:f.id},end:{type:"rectangle",id:m.id}}),u=Vt(o,w);a.push(u);let{relationTitle1:A,relationTitle2:g}=i,T=20,C=15,D=15,k,I;if(A&&A!=="none"){switch(o){case"TB":k=u.startX-T,u.endX<u.startX&&(k-=D),I=u.startY+C;break;case"BT":k=u.startX+T,u.endX>u.startX&&(k+=D),I=u.startY-C;break;case"LR":k=u.startX+T,I=u.startY+C,u.endY>u.startY&&(I+=D);break;case"RL":k=u.startX-T,I=u.startY-C,u.startY>u.endY&&(I-=D);break;default:k=u.startX-T,I=u.startY+C}let X=K(k,I,A,{fontSize:16});s.push(X)}if(g&&g!=="none"){switch(o){case"TB":k=u.endX+T,u.endX<u.startX&&(k+=D),I=u.endY-C;break;case"BT":k=u.endX-T,u.endX>u.startX&&(k-=D),I=u.endY+C;break;case"LR":k=u.endX-T,I=u.endY-C,u.endY>u.startY&&(I-=D);break;case"RL":k=u.endX+T,I=u.endY+C,u.startY>u.endY&&(I+=D);break;default:k=u.endX+T,I=u.endY-C}let X=K(k,I,g,{fontSize:16});s.push(X)}}),{arrows:a,text:s}},Wt=(t,e,r)=>{let o=[],n=[];return t.forEach(a=>{let{id:s,text:i,class:c}=a,l=e.querySelector(`#${s}`);if(!l)throw new Error(`Node with id ${s} not found!`);let{transformX:d,transformY:p}=P(l),f=l.firstChild,m=N(f,"rectangle",{id:s,subtype:"note",label:{text:i}});if(Object.assign(m,{x:m.x+d,y:m.y+p}),o.push(m),c){let x=r.find(A=>A.id===c);if(!x)throw new Error(`class node with id ${c} not found!`);let b=m.x+(m.width||0)/2,E=m.y+(m.height||0),y=b,w=x.y,u=tt(b,E,y,w,{strokeStyle:"dotted",startArrowhead:null,endArrowhead:null,start:{id:m.id,type:"rectangle"},end:{id:x.id,type:"rectangle"}});n.push(u)}}),{notes:o,connectors:n}},wt=(t,e)=>{t.parse();let r=t.parser.yy,o=r.getDirection(),n=[],a=[],s=[],i=[],c=r.getNamespaces(),l=r.getClasses();if(Object.keys(l).length){let b=Ut(l,e);n.push(b.nodes),a.push(...b.lines),s.push(...b.text),i.push(...b.nodes)}let d=r.getRelations(),{arrows:p,text:f}=zt(d,i,e,o),{notes:m,connectors:x}=Wt(r.getNotes(),e,i);return n.push(m),p.push(...x),s.push(...f),{type:"class",nodes:n,lines:a,arrows:p,text:s,namespaces:c}};var Ht=t=>{let e=t.querySelector("svg");if(!e)throw new Error("SVG element not found");let r=e.getBoundingClientRect(),o=r.width,n=r.height;e.setAttribute("width",`${o}`),e.setAttribute("height",`${n}`);let a="image/svg+xml",s=unescape(encodeURIComponent(e.outerHTML)),c=`data:image/svg+xml;base64,${btoa(s)}`;return{type:"graphImage",mimeType:a,dataURL:c,width:o,height:n}},At=async t=>{F.initialize(ot);let e=await F.mermaidAPI.getDiagramFromText(ft(t)),{svg:r}=await F.render("mermaid-to-excalidraw",t),o=document.createElement("div");o.setAttribute("style","opacity: 0; position: relative; z-index: -1;"),o.innerHTML=r,o.id="mermaid-diagram",document.body.appendChild(o);let n;switch(e.type){case"flowchart-v2":{n=ht(e,o);break}case"sequence":{n=yt(e,o);break}case"classDiagram":{n=wt(e,o);break}default:n=Ht(o)}return o.remove(),n};var Er=async(t,e={})=>{let r=await At(t);return mt(r,e)};export{Er as parseMermaidToExcalidraw};
